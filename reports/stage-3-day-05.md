────────────────────────────────────────
Этап 1️⃣ день 5️⃣
────────────────────────────────────────

❗ JOIN — объединение таблиц  
(как соединить строки из 2 таблиц по общему полю)

❗ INNER JOIN — возвращает только те строки, которые есть в обеих таблицах.

Пример:

SELECT o.order_id, u.name, o.total_amount
FROM orders o
JOIN users u
  ON o.user_id = u.id;

Читается так:
возьми заказ, найди пользователя, у которого id = user_id, соедини их в одну строку.

────────────────────────────────────────

❗ Если используешь JOIN, все столбцы надо указывать с префиксом таблицы:
- не name
- а u.name

────────────────────────────────────────

❗ LEFT JOIN — показывает все строки из левой таблицы и подтягивает данные из правой, если они есть  
(если совпадений нет — то справа будет NULL)

────────────────────────────────────────

❗ После FROM идёт ГЛАВНАЯ таблица

────────────────────────────────────────

❗ Проверка на NULL
- IS NULL
- IS NOT NULL

────────────────────────────────────────

❗ Если хочешь оставить все строки из левой таблицы, но фильтровать правую,
- нужно использовать ON,
- а не WHERE.

────────────────────────────────────────

❗ COALESCE — что нужно заменить и чем  
(пример: COALESCE(SUM(o.total_amount), 0))

────────────────────────────────────────
Задачи
────────────────────────────────────────

────────────────────────────────────────
1) Задача
────────────────────────────────────────

Нужно получить:
- список заказов вместе с данными пользователя

Нужно вывести:
- order_id
- name (из таблицы users)
- country
- total_amount

────────────────────────────────────────
2) Задача
────────────────────────────────────────

Нужно получить:
- список заказов

Условия:
- только со статусом completed

Нужно вывести:
- order_id
- name
- country
- total_amount
- order_date

────────────────────────────────────────
3) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по странам

Условия:
- учитывать только заказы со статусом completed

Нужно посчитать:
- количество заказов в каждой стране

Нужно отсортировать:
- по количеству заказов по убыванию

────────────────────────────────────────
4) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по пользователям

Условия:
- учитывать только заказы
- за последние 30 дней

Нужно посчитать:
- количество заказов каждого пользователя

Нужно вывести:
- u.id
- u.name
- количество заказов

Нужно оставить:
- только тех пользователей, у кого заказов не меньше 2

Нужно отсортировать:
- по количеству заказов по убыванию

────────────────────────────────────────
5) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по пользователям

Условия:
- учитывать только заказы
- со статусом completed

Нужно посчитать:
- общий оборот каждого пользователя

Нужно вывести:
- u.id
- u.name
- оборот

Нужно оставить:
- только тех пользователей, у кого оборот больше 1 000

Нужно отсортировать:
- по обороту по убыванию

────────────────────────────────────────
6) Задача
────────────────────────────────────────

Нужно получить:
- список всех пользователей и их заказов

Нужно вывести:
- u.id
- u.name
- o.order_id
- o.total_amount

────────────────────────────────────────
7) Задача
────────────────────────────────────────

Нужно найти:
- пользователей, у которых нет ни одного заказа

Нужно вывести:
- u.id
- u.name

────────────────────────────────────────
8) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по пользователям

Нужно:
- показать всех пользователей
- посчитать количество заказов каждого пользователя
- пользователи без заказов тоже должны быть в результате
- количество заказов для них должно быть 0

Нужно вывести:
- u.id
- u.name
- количество заказов

────────────────────────────────────────
9) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по пользователям

Нужно:
- показать всех пользователей
- посчитать количество их заказов
- учитывать только заказы со статусом completed
- пользователи без completed-заказов тоже должны быть в результате
- количество таких заказов должно быть 0

Нужно вывести:
- u.id
- u.name
- количество completed-заказов

────────────────────────────────────────
10) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по странам пользователей

Условия:
- учитывать только заказы
- со статусом completed

Нужно посчитать:
- общий оборот по каждой стране

Нужно вывести:
- страну пользователя
- оборот

Нужно отсортировать:
- по обороту по убыванию

────────────────────────────────────────
11) Задача
────────────────────────────────────────

Нужно получить:
- список всех пользователей и сумму их заказов

Условия:
- показать всех пользователей
- учитывать только заказы со статусом completed
- пользователи без completed-заказов тоже должны быть в результате
- сумма для них должна быть 0

Нужно вывести:
- u.id
- u.name
- сумму заказов

────────────────────────────────────────
12) Задача
────────────────────────────────────────

Нужно получить:
- список пользователей, у которых есть хотя бы один заказ

Нужно вывести:
- u.id
- u.name

────────────────────────────────────────
13) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по пользователям

Условия:
- учитывать только заказы со статусом completed

Нужно посчитать:
- количество заказов каждого пользователя

Нужно вывести:
- u.id
- u.name
- количество заказов

Нужно оставить:
- только пользователей, у которых completed-заказов больше 3

Нужно отсортировать:
- по количеству заказов по убыванию

────────────────────────────────────────
14) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по странам пользователей

Нужно:
- показать все страны, которые есть в users
- посчитать количество заказов в каждой стране
- пользователи без заказов должны учитываться
- заказы считаем все (без фильтра по статусу)

Нужно вывести:
- страну (из users)
- количество заказов

────────────────────────────────────────
15) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по пользователям

Нужно:
- показать всех пользователей
- посчитать количество их заказов
- только со статусом completed
- пользователи без completed-заказов тоже должны быть в результате

Нужно вывести:
- u.id
- u.name
- количество completed-заказов

────────────────────────────────────────
16) Задача
────────────────────────────────────────

Нужно получить:
- список стран, в которых есть хотя бы один пользователь, сделавший заказ

Нужно вывести:
- только страну

────────────────────────────────────────
17) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по пользователям

Нужно:
- показать всех пользователей
- учитывать только заказы
- за последние 30 дней
- и только со статусом completed

Нужно посчитать:
- количество таких заказов у каждого пользователя

Нужно оставить:
- только тех пользователей, у которых таких заказов ≥ 2

Нужно отсортировать:
- по количеству заказов по убыванию

Нужно вывести:
- u.id
- u.name
- количество заказов

────────────────────────────────────────
18) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по странам пользователей

Нужно:
- учитывать только заказы со статусом completed

Нужно посчитать для каждой страны:
- количество заказов
- общий оборот

Нужно оставить:
- только те страны, где
- заказов больше 5
- и оборот больше 10 000

Нужно отсортировать:
- по обороту по убыванию

Нужно вывести:
- страну
- количество заказов
- оборот

────────────────────────────────────────
19) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по странам пользователей

Нужно:
- показать все страны, которые есть в users

Нужно посчитать:
- количество пользователей в стране
- количество пользователей в стране, у которых есть хотя бы один заказ

Нужно отсортировать результат:
- по количеству пользователей по убыванию

Нужно вывести:
- страну
- количество пользователей
- количество пользователей с заказами

⚠️ Важно:
- мы считаем пользователей, а не заказы

────────────────────────────────────────
20) Задача
────────────────────────────────────────

Нужно получить:
- отчёт по странам пользователей

Нужно:
- показать все страны из таблицы users

Нужно посчитать:
- количество пользователей в стране
- количество пользователей в стране, у которых есть completed-заказы

Нужно отсортировать результат:
- по количеству пользователей по убыванию

Нужно вывести:
- страну
- количество пользователей
- количество пользователей с completed-заказами

⚠️ Важно:
- мы считаем именно пользователей
- пользователи без заказов должны присутствовать
- completed-фильтр нельзя писать в WHERE
