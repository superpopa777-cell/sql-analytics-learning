────────────────────────────────────────
DISTINCT и агрегатные функции
────────────────────────────────────────

❗ DISTINCT — уникальные значения (убирает дубликаты и оставляет только уникальные комбинации значений).
DISTINCT не считает, не сортирует, не группирует логически,
он просто говорит: «оставь уникальные».

Пример:

SELECT DISTINCT category
FROM orders;

Обозначает: какие уникальные категории вообще есть в заказах.

────────────────────────────────────────

❗ Агрегатные функции

Сегодня используем:

────────────────────────────────────────
❗ COUNT() — количество строк
────────────────────────────────────────

SELECT COUNT(*)
FROM orders;
= считает сколько строк в таблице

SELECT COUNT(column)
FROM orders;
= считает только те строки, где в этом столбце значение не равно NULL.
(NULL — отсутствие значения)

SELECT COUNT(DISTINCT category)
FROM orders;
= считает сколько уникальных категорий

────────────────────────────────────────
❗ SUM() — сумма
────────────────────────────────────────

SELECT SUM(total_amount)
FROM orders;

────────────────────────────────────────
❗ AVG() — среднее значение
────────────────────────────────────────

SELECT AVG(total_amount)
FROM orders;

────────────────────────────────────────
❗ MIN() — минимальное значение
────────────────────────────────────────

────────────────────────────────────────
❗ MAX() — максимальное значение
────────────────────────────────────────

────────────────────────────────────────
❗ GROUP BY — группировка
(объединяет строки в группы чтобы считать агрегаты по каждой группе)
────────────────────────────────────────

SELECT category, COUNT(*)
FROM orders
GROUP BY category;

Обозначает: Разбей заказы по категориям и посчитай количество заказов в каждой

────────────────────────────────────────
❗ GROUP BY + WHERE — фильтрует строки до группировки
────────────────────────────────────────

SELECT category, COUNT(*)
FROM orders
WHERE order_status = 'completed'
GROUP BY category;

────────────────────────────────────────
GROUP BY против DISTINCT
────────────────────────────────────────

SELECT DISTINCT category
FROM orders;

И

SELECT category
FROM orders
GROUP BY category;

Оба запроса возвращают одинаковый результат, но GROUP BY мощнее, потому что позволяет использовать агрегатные функции.

────────────────────────────────────────
❗ HAVING — фильтрация групп
(HAVING используется для фильтрации уже сгруппированных данных)
────────────────────────────────────────

В отличие от WHERE:

- WHERE работает со строками
- HAVING работает с группами

SELECT category, COUNT(*)
FROM orders
GROUP BY category
HAVING COUNT(*) > 5;

Пример: оставь только те категории, где количество заказов больше 5.

────────────────────────────────────────
Полный порядок команд из изученных нами:
────────────────────────────────────────

SELECT ...
FROM ...
WHERE ...
GROUP BY ...
HAVING ...
ORDER BY ...

────────────────────────────────────────
1) Задание 1
────────────────────────────────────────

Нужно получить отчёт:
- по категориям заказов

Условия:
- учитывать только заказы со статусом completed

Нужно посчитать:
- количество заказов в категории

Нужно оставить:
- только те категории, где заказов больше 5

Нужно отсортировать результат:
- по количеству заказов по убыванию

────────────────────────────────────────
2) Задача
────────────────────────────────────────

Нужно получить отчёт:
- по категориям

Условия:
- учитывать только заказы
- в категории не равной Books

Нужно посчитать:
- общий оборот по каждой категории (сумма total_amount)

Нужно оставить:
- только те категории, где оборот больше 10 000

Нужно отсортировать результат:
- по обороту по убыванию

────────────────────────────────────────
3) Задача
────────────────────────────────────────

Нужно получить отчёт:
- по странам

Условия:
- учитывать только заказы
- за последние 30 дней

Нужно посчитать:
- количество заказов в каждой стране

Нужно оставить:
- только те страны, где заказов не меньше 3

Нужно отсортировать результат:
- по количеству заказов по убыванию

────────────────────────────────────────
4) Задача
────────────────────────────────────────

Нужно получить отчёт:
- по странам

Условия:
- учитывать только заказы
- со статусом completed

Нужно посчитать:
- общий оборот (SUM(total_amount)) по каждой стране

Нужно оставить:
- только те страны, где оборот больше 5 000

Нужно отсортировать результат:
- по обороту по убыванию

────────────────────────────────────────
5) Задача
────────────────────────────────────────

Нужно получить отчёт:
- по категориям

Условия:
- учитывать только заказы
- за последние 30 дней
- и только со статусом completed

Нужно посчитать:
- средний чек (AVG(total_amount)) по каждой категории

Нужно оставить:
- только те категории, где средний чек больше 200

Нужно отсортировать результат:
- по среднему чеку по убыванию

────────────────────────────────────────
6) Задача
────────────────────────────────────────

Нужно найти:
- максимальную сумму заказа

Условия:
- только для заказов со статусом completed
- за последние 30 дней

────────────────────────────────────────
❗❗❗ ИТОГИ 1 этап 4 день:
────────────────────────────────────────

- Узнали что такое DISTINCT и для чего он используется
- Как работают агрегатные функции COUNT, SUM, AVG
- Чем отличается COUNT(*) от COUNT(column)
- Что такое NULL и почему это важно
- Как работает GROUP BY
- Как комбинировать GROUP BY и WHERE
- Чем отличается WHERE от HAVING
- Как сортировать агрегированные данные через ORDER BY
- Правильный порядок команд в аналитическом SQL-запросе
